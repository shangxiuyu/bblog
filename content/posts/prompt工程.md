---
title: "prompt工程"
date: 2025-11-03
draft: false
tags: ["AI", "prompt"]
---


# Prompt 工程基础

## 提示工程：与大语言模型对话的艺术

同样是问 ChatGPT“帮我写一段代码”，有人得到了完美的解决方案，有人却只收获一堆无法运行的代码。区别在哪里？答案是**提示词（Prompt）**的设计。

提示工程（Prompt Engineering）是一门与大语言模型有效沟通的技术。它不需要数学基础，也不涉及模型训练，却直接决定了你能从大语言模型那里获得多少价值。

对于智能体开发者来说，提示工程更是核心技能——智能体的“人格”“能力”“行为准则”，都是通过提示词来定义的。

---

## 提示词的基本结构

当你使用 ChatGPT 或调用大语言模型 API 时，你输入的所有文字都是提示词的一部分。在现代 API 中，提示词通常以**对话消息列表**的形式组织：

```python
messages = [
    {
        "role": "system",
        "content": "你是一个专业的旅行规划助手..."  # 系统提示词
    },
    {
        "role": "user",
        "content": "帮我规划一次三天的北京之旅"  # 用户输入
    }
]
```

### 三种角色，三种用途

| 角色        | 作用               | 类比          |
| --------- | ---------------- | ----------- |
| system    | 定义智能体的身份、能力和行为规范 | 导演给演员的角色说明书 |
| user      | 用户的具体任务和问题       | 观众的提问       |
| assistant | 模型之前的回复记录        | 演员已经说过的台词   |

这三种角色的设计非常巧妙：

* **System Prompt** 是智能体的“人格设定”，确定后通常保持不变
* **User Prompt** 是动态的任务输入，每次交互都可能不同
* **Assistant** 记录让模型“记住”之前说过什么，实现多轮对话

其中，**System Prompt 的优先级最高**——当用户指令与系统设定冲突时，模型会优先遵循系统设定。这是构建安全、可控智能体的关键。

---

## System Prompt 设计原则

System Prompt 是智能体的“灵魂”。设计得当，智能体就是靠谱的专家；设计不当，智能体就是胡言乱语的话痨。

一个好的 System Prompt 通常包含四个要素。

### 要素一：角色定义

告诉模型“你是谁”，这会激活它在特定领域的知识。

**对比示例：**

```text
# 模糊的定义
你是一个助手。
```

```text
# 清晰的定义
你是一个专业的 Python 后端开发专家，擅长 FastAPI 框架、
关系型数据库设计和系统性能优化。具有 10 年企业级应用开发经验。
```

为什么这很重要？

因为大语言模型在训练时见过大量“专家”撰写的文本。明确的角色定义，相当于告诉模型：

> “请调用你作为专家时的知识和表达方式” [1]

---

### 要素二：能力声明

告诉模型“你能做什么、不能做什么”。明确的能力边界可以减少模型“吹牛”，降低幻觉发生率。

**核心能力：**

1. 查询实时天气信息（通过 `weather_api` 工具）
2. 搜索旅游景点信息（通过 `search` 工具）
3. 规划行程路线和估算旅行预算

**能力边界：**

* 无法直接预订机票或酒店（需引导用户使用专业平台）
* 不提供医疗诊断或法律咨询服务

---

### 要素三：行为约束

定义智能体的“行为准则”——什么该做，什么不该做，怎么做。

**行为准则示例：**

* 采用 **Think → Act → Observe** 的工作模式
* 每次仅调用一个工具函数
* 信息不足时主动向用户请求补充
* 拒绝处理危险或违法请求
* 输出必须符合 JSON 格式规范

---

### 要素四：输出格式规范

这是智能体提示词设计的核心——**结构化输出**。智能体需要可被程序解析的结果，JSON 是最常用选择。

```json
{
  "thought": "当前的分析和推理过程",
  "action": {
    "tool": "工具名称",
    "parameters": {
      "参数名": "参数值"
    }
  }
}
```

**示例：**

```json
{
  "thought": "用户询问北京天气，需要调用天气查询工具获取实时数据",
  "action": {
    "tool": "get_weather",
    "parameters": {
      "city": "北京"
    }
  }
}
```

---

## 完整 System Prompt 示例

以下是一个**智能旅行助手**的完整 System Prompt 示例：

```text
# 角色定义
系统是一个专业的智能旅行规划助手，命名为 TravelBot。
具备丰富的旅游行业知识，能够根据用户偏好规划个性化行程。

# 核心能力
1. 查询目的地天气（get_weather）
2. 搜索旅游景点（search_attractions）
3. 计算行程预算（calculate_budget）
4. 推荐餐厅酒店（search_places）

# 工作流程
1. 分析用户需求
2. 制定解决方案
3. 逐步调用工具
4. 综合信息输出建议

# 输出格式（JSON）
{ ... }

# 约束条件
- 不得编造信息
- 每次仅调用一个工具
- 信息不足需请求补充
- 注意旅行安全
- 考虑预算限制
```

---

##  User Prompt 优化技术

### 技巧一：提供充分上下文

```text
# 不推荐
帮我写个函数
```

```text
# 推荐
请使用 Python 编写一个函数：
- 输入：用户信息字典列表
- 逻辑：过滤年龄 >18 且邮箱已验证的用户
- 输出：过滤后的列表
- 规范：类型注解 + 文档字符串
```

---

### 技巧二：Few-shot 学习

通过少量示例引导模型理解任务模式。

```json
输入: "张三,男,30岁,软件工程师,北京"
输出: {
  "name": "张三",
  "gender": "男",
  "age": 30,
  "occupation": "软件工程师",
  "location": "北京"
}
```

---

### 技巧三：思维链（Chain-of-Thought）

让模型“一步一步想”，在数学和逻辑任务中准确率可提升 30–50%。

---

## 提示词调试：一门实验科学

提示工程的本质是：**试错 + 迭代**。

**基本流程：**

1. 编写初版 Prompt
2. 测试输出
3. 识别问题
4. 调整 Prompt
5. 重新测试

循环迭代，直到满意。

---

## 动手实践：构建智能体提示系统

### 定义工具接口

```python
tools = [
    {"name": "get_weather", "description": "查询天气"},
    {"name": "search_attractions", "description": "搜索景点"}
]
```

### 动态生成 System Prompt

```python
system_prompt = f"""
你是 TravelBot...
可用工具：{tools}
"""
```

---

## 提示工程不是万能药

提示工程无法解决：

* 知识时效性（需 RAG）
* 精确计算（需工具调用）
* 幻觉问题（需反思与验证机制）

---

## Prompt 的本质

好的 Prompt 不是告诉 AI“你是谁”，而是告诉 AI：

> **你应该如何思考、如何决策。**

这也是从“身份标签”到“认知框架”的跃迁。

---

## 本节小结

1. System Prompt 四要素：角色、能力、行为、格式
2. User Prompt 三技巧：上下文、示例、思维链
3. 调试方法：实验 + 迭代
4. 理解局限：Prompt 不是银弹

---

## 参考文献

1. Brown et al., *Language Models are Few-Shot Learners*, NeurIPS 2020
2. Radford et al., *Language Models are Unsupervised Multitask Learners*, OpenAI 2019
3. Dong et al., *A Survey on In-Context Learning*, arXiv 2022
4. Wei et al., *Chain-of-Thought Prompting*, NeurIPS 2022

